!function(e){var t={$currentImgWrap:null,$magnifier:null,$magnifierImg:null,$magnifierState:null,init:function(){t.$magnifier=e('<div id="zm-magnifier"><img style="position:relative;left:0;top:0;"/><span>1X</span></div>').appendTo("body"),t.$magnifierImg=e("img",t.$magnifier),t.$magnifierState=e("span",t.$magnifier),e(document).bind("mousemove",function(e){t.$currentImgWrap&&t.movemagnifier(e)}),t.$magnifier.mousewheel(function(e,r,i,o){var a=t.$currentImgWrap.get(0).zoominfo,n=o>0?1:-1,m=Math.round(10*(a.currentZoom+a.zoomStep*n))/10;m<=a.zoomRange[1]&&m>=a.zoomRange[0]&&(a.currentZoom=m,t.$magnifierImg.css({left:-(e.pageX-a.coords.left)*a.currentZoom+a.magnifierSize[0]/2,top:-(e.pageY-a.coords.top)*a.currentZoom+a.magnifierSize[1]/2,width:a.imgSize.width*a.currentZoom,height:a.imgSize.height*a.currentZoom}),t.$magnifierState.text(a.currentZoom+"X")),e.preventDefault()})},setup:function(r,i,o){if("zm-magnifier"!=r.parent().attr("id")){var a,n;r.wrap('<div class="zm-wrap"></div>');var m=r.parent();"transparent"==i.hoverEf?n=e('<div class="zm-hover zm-trans"></div>').appendTo(m):(n=r.clone().addClass("zm-hover").appendTo(m),"grayscale"==i.hoverEf?o.grayscale(n):"blur"==i.hoverEf&&(e.browser.msie?n.addClass("zm-blur"):o.blur(n,3))),r.attr(i.largeImgAttr)?(a=r.attr(i.largeImgAttr),(new Image).src=a):a=r.attr("src"),m.get(0).zoominfo={defaultZoom:i.defaultZoom,zoomStep:i.zoomStep,zoomRange:i.zoomRange,showZoomState:i.showZoomState,borderSize:3,imgSize:null,coords:null,largeImg:null,currentZoom:i.defaultZoom,magnifierSize:i.magnifierSize},m.bind("mouseover",function(){t.$currentImgWrap=e(this);var r=e("img:first",this),o=e(this).get(0).zoominfo;o.coords={left:r.offset().left,top:r.offset().top,right:r.offset().left+r.width(),bottom:r.offset().top+r.height()},o.largeImg=r.attr(i.largeImgAttr)?r.attr(i.largeImgAttr):r.attr("src"),o.imgSize={width:r.width(),height:r.height()},e(this).get(0).zoominfo=o,t.$magnifierImg.attr("src",o.largeImg).css({width:o.currentZoom*o.imgSize.width,height:o.currentZoom*o.imgSize.height}),t.$magnifier.css({width:o.magnifierSize[0],height:o.magnifierSize[1]}).fadeIn(300),o.showZoomState?t.$magnifierState.text(o.currentZoom+"X").show():t.$magnifierState.hide(),e(this).find(".zm-hover").fadeIn(400)})}},movemagnifier:function(e){var r=t.$currentImgWrap.get(0).zoominfo;e.pageX>=r.coords.left&&e.pageX<=r.coords.right&&e.pageY>=r.coords.top&&e.pageY<=r.coords.bottom?(t.$magnifier.css({left:e.pageX-r.magnifierSize[0]/2-r.borderSize,top:e.pageY-r.magnifierSize[1]/2-r.borderSize}),t.$magnifierImg.css({left:-(e.pageX-r.coords.left)*r.currentZoom+r.magnifierSize[0]/2,top:-(e.pageY-r.coords.top)*r.currentZoom+r.magnifierSize[1]/2})):(t.$currentImgWrap.find(".zm-hover").fadeOut(300),t.$currentImgWrap=null,t.$magnifier.hide())}};!function(e){var r={img2Gray:function(t){try{var r=document.createElement("canvas"),i=r.getContext("2d");r.height=t.height,r.width=t.width,i.drawImage(t,0,0,t.width,t.height);for(var o=i.getImageData(0,0,t.width,t.height),a=0;a<o.height;a++)for(var n=0;n<o.width;n++){var m=4*a*o.width+4*n,g=(o.data[m]+o.data[m+1]+o.data[m+2])/3;o.data[m]=g,o.data[m+1]=g,o.data[m+2]=g}i.putImageData(o,0,0,0,0,o.width,o.height),e(t).attr("src",r.toDataURL())}catch(e){alert("Canvas can not getImageData from local or corss domain image!")}},grayscale:function(t){e.browser.msie?t.addClass("zm-gray"):r.img2Gray(t.get(0))},blur:function(e,t){function r(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}try{var i=document.createElement("canvas"),o=i.getContext("2d"),a=i.width=e.width(),n=i.height=e.height();o.drawImage(e.get(0),0,0,a,n);var m,g,s,h,f,l,u,d,c,v,p,w,z,S,I,b,$,x,Z,D,y=o.getImageData(0,0,i.width,i.height),X=y.data,E=t+t+1,R=a-1,A=n-1,C=t+1,L=C*(C+1)/2,W=new r,Y=W;for(s=1;s<E;s++)if(Y=Y.next=new r,s==C)var H=Y;Y.next=W;var M=null,O=null;u=l=0;var T=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259][t],j=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24][t];for(g=0;g<n;g++){for(S=I=b=d=c=v=0,p=C*($=X[l]),w=C*(x=X[l+1]),z=C*(Z=X[l+2]),d+=L*$,c+=L*x,v+=L*Z,Y=W,s=0;s<C;s++)Y.r=$,Y.g=x,Y.b=Z,Y=Y.next;for(s=1;s<C;s++)h=l+((R<s?R:s)<<2),d+=(Y.r=$=X[h])*(D=C-s),c+=(Y.g=x=X[h+1])*D,v+=(Y.b=Z=X[h+2])*D,S+=$,I+=x,b+=Z,Y=Y.next;for(M=W,O=H,m=0;m<a;m++)X[l]=d*T>>j,X[l+1]=c*T>>j,X[l+2]=v*T>>j,d-=p,c-=w,v-=z,p-=M.r,w-=M.g,z-=M.b,h=u+((h=m+t+1)<R?h:R)<<2,S+=M.r=X[h],I+=M.g=X[h+1],b+=M.b=X[h+2],d+=S,c+=I,v+=b,M=M.next,p+=$=O.r,w+=x=O.g,z+=Z=O.b,S-=$,I-=x,b-=Z,O=O.next,l+=4;u+=a}for(m=0;m<a;m++){for(I=b=S=c=v=d=0,p=C*($=X[l=m<<2]),w=C*(x=X[l+1]),z=C*(Z=X[l+2]),d+=L*$,c+=L*x,v+=L*Z,Y=W,s=0;s<C;s++)Y.r=$,Y.g=x,Y.b=Z,Y=Y.next;for(f=a,s=1;s<=t;s++)l=f+m<<2,d+=(Y.r=$=X[l])*(D=C-s),c+=(Y.g=x=X[l+1])*D,v+=(Y.b=Z=X[l+2])*D,S+=$,I+=x,b+=Z,Y=Y.next,s<A&&(f+=a);for(l=m,M=W,O=H,g=0;g<n;g++)X[h=l<<2]=d*T>>j,X[h+1]=c*T>>j,X[h+2]=v*T>>j,d-=p,c-=w,v-=z,p-=M.r,w-=M.g,z-=M.b,h=m+((h=g+C)<A?h:A)*a<<2,d+=S+=M.r=X[h],c+=I+=M.g=X[h+1],v+=b+=M.b=X[h+2],M=M.next,p+=$=O.r,w+=x=O.g,z+=Z=O.b,S-=$,I-=x,b-=Z,O=O.next,l+=a}o.putImageData(y,0,0),e.attr("src",i.toDataURL())}catch(e){alert("Canvas can not getImageData from local or corss domain image!")}}};e.fn.zoome=function(i){var o=e.extend({defaultZoom:2,largeImgAttr:"rel",zoomRange:[1,10],zoomStep:1,showZoomState:!1,magnifierSize:[140,140],borderSize:3,hoverEf:"normal"},i);return this.each(function(){if("IMG"!=this.tagName)return!0;e(this).attr("src")&&""!=e.trim(e(this).attr("src"))&&(this.complete?t.setup(e(this),o,r):e(this).one("load",function(){t.setup(e(this),o,r)}))})}}(jQuery),function(e){var t=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var r=t.length;r;)e.event.fixHooks[t[--r]]=e.event.mouseHooks;function i(t){var r=t||window.event,i=[].slice.call(arguments,1),o=0,a=0,n=0;return(t=e.event.fix(r)).type="mousewheel",r.wheelDelta&&(o=r.wheelDelta/120),r.detail&&(o=-r.detail/3),n=o,void 0!==r.axis&&r.axis===r.HORIZONTAL_AXIS&&(n=0,a=-1*o),void 0!==r.wheelDeltaY&&(n=r.wheelDeltaY/120),void 0!==r.wheelDeltaX&&(a=-1*r.wheelDeltaX/120),i.unshift(t,o,a,n),(e.event.dispatch||e.event.handle).apply(this,i)}e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=t.length;e;)this.addEventListener(t[--e],i,!1);else this.onmousewheel=i},teardown:function(){if(this.removeEventListener)for(var e=t.length;e;)this.removeEventListener(t[--e],i,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery),e(function(){t.init()})}(jQuery);